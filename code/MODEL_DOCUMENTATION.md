# NBA 球队评估模型文档

## 模型概述

本模型用于评估 NBA 球队阵容方案，预测两个核心指标：
1. **预期总胜场** (常规赛 + 季后赛)
2. **净利润** (总收入 - 总成本)

模型针对金州勇士队 2025-26 赛季的球员替换决策设计。

---

## 模型架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         输入: 阵容名单                               │
│                    (球员名字列表)                                    │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                     1. Win Shares 计算                               │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  总WS = Σ(球员WS) + Σ(化学反应Bonus)                         │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  2. 常规赛胜场计算                                    │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  常规赛胜场 = 基础胜场 (20) + 总WS                            │    │
│  │  限制范围 [0, 82]                                            │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  3. 季后赛判定                                        │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  进入概率:                                                    │    │
│  │    胜场 ≥ 48: 100% (直通)                                     │    │
│  │    40 ≤ 胜场 < 48: (胜场 - 40) × 12.5% (附加赛)               │    │
│  │    胜场 < 40: 0% (无缘)                                       │    │
│  │                                                              │    │
│  │  季后赛轮数 (基于胜场和核心OVR):                               │    │
│  │    >58胜 & OVR>92 → 4轮 (总决赛)                              │    │
│  │    53-58胜 & OVR>88 → 3轮 (分区决赛)                          │    │
│  │    48-52胜 & OVR>85 → 2轮 (次轮)                              │    │
│  │    40-47胜 → 0.5轮 (附加赛出局)                               │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  4. 季后赛胜场计算                                    │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  胜率 = 0.5 + (球队OVR - 对手OVR) × 0.05                      │    │
│  │  季后赛胜场 = 轮数 × 5.8 × 胜率                                │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  5. 收入计算                                         │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  收入 = 联盟分成 + 门票收入 + 季后赛收入 + 场馆收入 - 上缴分成   │    │
│  │                                                              │    │
│  │  门票收入 = 150 + 胜场×1.5 + 球星指数×80                       │    │
│  │  季后赛收入 = 轮数 × 20                                        │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  6. 成本计算                                         │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  成本 = 固定成本 ($250M) + 球员工资 + 奢侈税                    │    │
│  │                                                              │    │
│  │  奢侈税 (若工资 > $187.9M):                                    │    │
│  │    阶梯税率: 2.50倍, 2.75倍, 3.50倍, 4.25倍, 4.75倍            │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         输出                                         │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │  总胜场 = 常规赛胜场 + 季后赛胜场                              │    │
│  │  净利润 = 收入 - 成本                                         │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 核心公式

### 1. 常规赛胜场

$$W_{reg} = \text{Base\_Wins} + \sum_{i \in Roster} WS_i + \sum_{(p1,p2) \in Chemistry} Bonus_{p1,p2}$$

其中：
- `Base_Wins = 20` (替补级别球队的基础胜场)
- `WS_i` = 球员 i 的 Win Shares
- `Bonus` = 有化学反应的球员配对额外加成

### 2. 季后赛进入概率

$$P_{entry} = \begin{cases} 
1.0 & \text{若 } W_{reg} \geq 48 \\
(W_{reg} - 40) \times 0.125 & \text{若 } 40 \leq W_{reg} < 48 \\
0 & \text{若 } W_{reg} < 40
\end{cases}$$

### 3. 季后赛胜率

$$P_{win} = 0.5 + (OVR_{team} - OVR_{opponent}) \times 0.05$$

限制在 [0.3, 0.8] 范围内

### 4. 收入模型

$$Revenue = Base_{league} + Gate + Playoff + Arena - Sharing$$

其中：
- $Gate = 150 + W \times 1.5 + StarIndex \times 80$
- $Playoff = Rounds \times 20$
- $Sharing = (Gate + Arena) \times 0.25$

### 5. 净利润

$$NetProfit = Revenue - (FixedCost + Salary + LuxuryTax)$$

---

## 文件结构

```
美赛2026/
├── config.py              # 所有可配置参数
├── evaluate.py            # 核心评估模型
├── main_evaluation.py     # 主程序 + 可视化
├── MODEL_DOCUMENTATION.md # 本文档
└── figures/
    └── acquisition_strategy/
        └── kuminga_replacement_analysis.png
```

---

## 配置指南 (`config.py`)

### 1. 球员数据

#### 1.1 勇士队当前阵容 (`WARRIORS_ROSTER`)

```python
WARRIORS_ROSTER = {
    "S. Curry": {
        "Salary": 59.61,      # 薪资 (百万美元)
        "WS": 8.5,            # Win Shares (胜场贡献值)
        "OVR": 95,            # 2K 总评 (用于季后赛判定)
        "Star_Index": 1.0,    # 商业号召力 (0-1, 影响门票收入)
    },
    # ... 更多球员
}
```

**如何修改:**
- 从 Excel 文件 `【球星conf】勇士.xlsx` 获取数据
- `Salary`: 25-26赛季薪资，单位百万美元
- `WS`: Win Shares，来自 Basketball-Reference 或预估
- `OVR`: NBA 2K 游戏评分
- `Star_Index`: 相对于库里的商业价值 (库里=1.0)

#### 1.2 替换候选球员 (`REPLACEMENT_CANDIDATES`)

```python
REPLACEMENT_CANDIDATES = {
    "T. Herro": {
        "Salary": 31.00,
        "WS": 5.0,
        "OVR": 84,
        "Star_Index": 0.0421,
    },
    # ... 更多候选球员
}
```

**如何修改:**
- 从 Excel 文件 `【球星conf】替换.xlsx` 获取数据
- 添加或删除候选球员

---

### 2. 化学反应 (`CHEMISTRY_PAIRS`)

```python
CHEMISTRY_PAIRS = {
    ("S. Curry", "D. Green"): 1.5,    # 库里+格林: +1.5 胜
    ("J. Kuminga", "M. Moody"): 0.8,  # 库明加+穆迪: +0.8 胜
}
```

**规则:**
- 格式: `(球员1, 球员2): Bonus_WS`
- 当两名球员**同时在阵容中**时，额外增加 `Bonus_WS` 胜场
- 每个球员只能参与一组化学反应

**如何修改:**
- 增加新配对: `("Player A", "Player B"): 1.0`
- 修改 Bonus 值
- 删除不需要的配对

---

### 3. 基础阵容与替换目标

```python
BASE_ROSTER = [
    "S. Curry",
    "J. Butler", 
    "D. Green",
    "B. Podziemski",
    "M. Moody",
    "T. Jackson-Davis",
    "B. Hield",
]

PLAYER_TO_REPLACE = "J. Kuminga"
```

**说明:**
- `BASE_ROSTER`: 保留的核心球员（不会被替换）
- `PLAYER_TO_REPLACE`: 要被替换的球员
- 模型会将 `REPLACEMENT_CANDIDATES` 中的每个球员替换进 `BASE_ROSTER`

**如何修改:**
- 更换被替换的球员
- 调整核心阵容

---

### 4. 财务参数 (`FINANCIAL_PARAMS`)

```python
FINANCIAL_PARAMS = {
    # 成本
    "fixed_cost": 250.0,              # 固定运营成本 ($M)
    "luxury_tax_threshold": 187.9,    # 奢侈税起征线 ($M)
    
    # 收入
    "base_league_revenue": 230.0,     # 联盟转播分成 ($M)
    "base_gate_revenue": 150.0,       # 基础门票收入 ($M)
    "win_gate_multiplier": 1.5,       # 每胜增加门票收入 ($M)
    "star_gate_multiplier": 80.0,     # 球星指数对门票的影响
    "playoff_round_revenue": 20.0,    # 每轮季后赛额外收入 ($M)
    "arena_revenue": 280.0,           # 场馆非篮球收入 ($M)
    "revenue_sharing_rate": 0.25,     # 联盟收入分成比例
    
    # 奢侈税阶梯
    "tax_brackets": [
        (5, 2.50),   # 超额 0-5M: 2.5倍
        (5, 2.75),   # 超额 5-10M: 2.75倍
        (5, 3.50),   # 超额 10-15M: 3.5倍
        (5, 4.25),   # 超额 15-20M: 4.25倍
        (999, 4.75)  # 超额 20M+: 4.75倍
    ]
}
```

---

### 5. 常规赛参数 (`REGULAR_SEASON`)

```python
REGULAR_SEASON = {
    "total_games": 82,    # 常规赛总场次
    "base_wins": 20,      # 基础胜场 (无明星球员的垫底队水平)
}
```

**如何调整:**
- `base_wins`: 影响整体胜场预测基准
  - 增大 → 所有方案胜场上升
  - 减小 → 所有方案胜场下降

---

### 6. 季后赛参数 (`PLAYOFF_PARAMS`)

```python
PLAYOFF_PARAMS = {
    # 进入条件
    "direct_entry_wins": 48,          # 直通季后赛的胜场
    "playin_min_wins": 40,            # 进入附加赛的最低胜场
    "playin_prob_per_win": 0.125,     # 附加赛每胜增加的晋级概率
    
    # 轮数判定 (胜场阈值, OVR阈值, 轮数)
    "round_thresholds": [
        (58, 92, 4),    # 总决赛
        (53, 88, 3),    # 分区决赛
        (48, 85, 2),    # 次轮
        (40, 0, 0.5),   # 附加赛
    ],
    
    # 胜率计算
    "base_win_prob": 0.5,
    "ovr_diff_factor": 0.05,
    "avg_opponent_ovr": 85,
    
    # 场次
    "avg_games_per_round": 5.8,
}
```

---

## 使用方法

### 运行模型

```bash
python main_evaluation.py
```

### 输出内容

1. **控制台输出**: 详细评估结果表格
2. **可视化图表**: 2D 散点图 (胜场 vs 净利润)
3. **决策建议**: 最优替换球员推荐

### 输出示例

```
======================================================================
  Kuminga 替换方案对比
======================================================================

排名  球员                  胜场       净利润($M)    薪资($M)     推荐 
-------------------------------------------------------------------------
1     M. Bridges           73.8       $315.8       $23.5        *** 最佳
2     R. Barrett           73.4       $300.1       $27.7        *** 最佳
3     J. Kuminga (基准)    69.2       $298.2       $22.5        
4     K. Porzingis         77.5       $292.3       $30.7        * 胜场
...
```

---

## 敏感性分析

可以通过修改 `config.py` 进行敏感性分析:

| 参数 | 效果 |
|-----------|--------|
| `base_wins` ↑ | 所有方案胜场 ↑ |
| `win_gate_multiplier` ↑ | 高胜场方案利润 ↑ |
| `fixed_cost` ↑ | 所有方案利润 ↓ |
| `luxury_tax_threshold` ↓ | 高薪阵容成本 ↑ |
| Chemistry Bonus ↑ | 有化学反应的阵容胜场 ↑ |

---

## 模型局限性

1. **Win Shares 准确性**: WS 是历史统计，不能完美预测未来表现
2. **化学反应主观性**: Chemistry Bonus 需要专家判断
3. **伤病风险**: 模型未包含伤病概率
4. **对手变化**: 假设对手平均 OVR 固定为 85

---

## 版本历史

- **v2.0**: 添加替换分析功能，更新球员数据结构
- **v1.0**: 基础评估模型 (Plan A vs Plan B)
